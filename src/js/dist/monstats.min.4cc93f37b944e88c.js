var dependencies=["monstats-graph","monstats-services","monstats-utils"];angular.module("Monstats",dependencies).controller("Main",["$scope","MonsterBox","MonsterDB",function(a,b,c){a.store={monsters:[],search:"",selected:b.monsters,loading:!0,error:null,cached:null},a.addMonster=function(c){b.add(c),a.store.search=""},a.delMonster=function(a){b.del(a)},a.reload=function(){d(!0)};var d=function(b){var d=a.store,e=function(a){d.monsters=a.monsters,"cached"in a&&(d.cached=a.cached)},f=function(a){d.error="Cannot load Monster DB :c"};d.loading=!0,d.error=null,d.cached=null;var g=b?c.forceLoad():c.load();g.then(e,f)["finally"](function(){d.loading=!1})};d()}]),angular.module("monstats-graph",["monstats-services"]).controller("GraphControl",["$scope","Growth",function(a,b){var c=[],d=b.types[0],e=null;this.setStat=function(a){b.isValidType(a)&&(d=a)},this.setupChart=function(a){for(var b=[],c=1;100>c;c++)b.push(""+c);e=new Highcharts.Chart({chart:{renderTo:a},title:{text:""},xAxis:{categories:b},yAxis:{title:{text:""}},plotOptions:{series:{marker:{enabled:!1}}},tooltip:{shared:!0},legend:{labelFormatter:function(){return this.name},layout:"vertical",itemMarginTop:1,itemMarginBottom:1,verticalAlign:"top"},credits:!1})},this.addSerie=function(a){var f=c.indexOf(a);if(!(f>=0)){c.push(a);var g={};g.id=a.id,g.name=a.name,g.data=b.computeGraph(a,d),e.addSeries(g)}},this.removeSerie=function(a){var b=c.indexOf(a);b>=0&&c.splice(b,1);var d=e.get(a.id);d&&d.remove()}}]).directive("monsterGraph",[function(){return{restrict:"E",controller:"GraphControl",scope:{monsters:"=",stat:"@"},replace:!0,template:'<div>  <div></div>  <serie ng-repeat="monster in monsters" monster="monster" /></div>',link:function(a,b,c,d){"stat"in c&&d.setStat(c.stat),d.setupChart(b[0].children[0])}}}]).directive("serie",[function(){return{restrict:"E",require:"^monsterGraph",scope:{monster:"="},link:function(a,b,c,d){d.addSerie(a.monster),a.$on("$destroy",function(){d.removeSerie(a.monster)})}}}]),angular.module("monstats-services",[]).service("MonsterDB",["$q","$http",function(a,b){var c=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}},d=function(a){if(c()){var b=Math.floor(Date.now()/1e3);localStorage.setItem("monsters",JSON.stringify(a)),localStorage.setItem("cachedOn",b)}},e=function(){var b=a.defer();if(!c())return b.reject("HTML5 localstorage not supported"),b.promise;var d=localStorage.getItem("monsters"),e=localStorage.getItem("cachedOn");if(d&&e){var f={monsters:JSON.parse(d),cached:parseInt(e)};b.resolve(f)}else b.reject("Nothing in cache, yet");return b.promise},f=function(){return b.get("data/monsters.min.json").success(function(a){d(a)}).then(function(a){return{monsters:a.data}})};this.forceLoad=f,this.load=function(){var a=function(a){return a},b=function(a){return f()};return e().then(a,b)}}]).service("MonsterBox",[function(){this.monsters=[],this.add=function(a){this.monsters.indexOf(a)<0&&this.monsters.push(a)},this.del=function(a){var b=this.monsters.indexOf(a);b>-1&&this.monsters.splice(b,1)}}]).service("Growth",[function(){var a=function(a,b,c,d,e){return Math.round(b+(c-b)*Math.pow((a-1)/(d-1),e))};this.types=["atk","hp","rcv"],this.isValidType=function(a){return this.types.indexOf(a)>=0},this.computeGraph=function(b,c){if(!this.isValidType(c))return console.log("Error: illegal stat type",c),[];for(var d=b.max_level,e=b[c+"_min"],f=b[c+"_max"],g=b[c+"_scale"],h=[],i=1;d+1>i;i++)h.push(a(i,e,f,d,g));return h}}]),angular.module("monstats-utils",[]).directive("preventDefault",[function(){return function(a,b,c){angular.element(b).bind("click",function(a){a.preventDefault(),a.stopPropagation()})}}]).filter("byName",[function(){return function(a,b){return!a||!b||b.length<3?[]:a.filter(function(a){return a.name.toLowerCase().indexOf(b.toLowerCase())>-1})}}]);