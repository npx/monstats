angular.module("App",[]).service("MonsterDB",["$q","$http",function(a,b){var c=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}},d=function(a){if(c()){var b=Math.floor(Date.now()/1e3);localStorage.setItem("monsters",JSON.stringify(a)),localStorage.setItem("cachedOn",b)}},e=function(){var b=a.defer();if(!c())return b.reject("HTML5 localstorage not supported"),b.promise;var d=localStorage.getItem("monsters"),e=localStorage.getItem("cachedOn");if(d&&e){var f={monsters:JSON.parse(d),cached:parseInt(e)};b.resolve(f)}else b.reject("Nothing in cache, yet");return b.promise},f=function(){return b.get("data/monsters.min.json").success(function(a){d(a)}).then(function(a){return{monsters:a.data}})};this.forceLoad=f,this.load=function(){var a=function(a){return a},b=function(a){return f()};return e().then(a,b)}}]).service("MonsterBox",[function(){this.monsters=[],this.add=function(a){this.monsters.indexOf(a)<0&&this.monsters.push(a)},this.del=function(a){var b=this.monsters.indexOf(a);b>-1&&this.monsters.splice(b,1)}}]).controller("Main",["$scope","MonsterBox","MonsterDB",function(a,b,c){a.store={monsters:[],search:"",selected:b.monsters,loading:!0,error:null,cached:null},a.addMonster=function(c){b.add(c),a.store.search=""},a.delMonster=function(a){b.del(a)},a.reload=function(){d(!0)};var d=function(b){var d=a.store,e=function(a){d.monsters=a.monsters,"cached"in a&&(d.cached=a.cached)},f=function(a){d.error="Cannot load Monster DB :c"};d.loading=!0,d.error=null,d.cached=null;var g=b?c.forceLoad():c.load();g.then(e,f)["finally"](function(){d.loading=!1})};d()}]).directive("monsterGraph",["Growth",function(a){return{restrict:"E",scope:{data:"=monsters",stat:"@"},template:"<div></div>",replace:!0,link:function(b,c,d){var e=a.types[0];"stat"in d&&a.isValidType(d.stat)&&(e=d.stat);for(var f=c[0],g=[],h=1;100>h;h++)g.push(""+h);var i=new Highcharts.Chart({chart:{renderTo:f},title:{text:""},xAxis:{categories:g},yAxis:{title:{text:""},plotLines:[{value:0,width:1,color:"#808080"},{value:0,width:1,color:"#FF0000"}]},plotOptions:{series:{marker:{enabled:!1}}},tooltip:{shared:!0},legend:{labelFormatter:function(){return this.name+" <em>x</em>"},layout:"vertical",itemMarginTop:1,itemMarginBottom:1,verticalAlign:"top"},series:[],credits:!1}),j=function(b){for(;i.series.length>0;)i.series[0].remove(!0);angular.forEach(b,function(b){var c={};c.name=b.name,c.data=a.computeGraph(b,e),i.addSeries(c,!1)}),i.redraw()};b.$watchCollection("data",function(a){a&&a.length>0&&j(a)})}}}]).service("Growth",[function(){var a=function(a,b,c,d,e){return Math.round(b+(c-b)*Math.pow((a-1)/(d-1),e))};this.types=["atk","hp","rcv"],this.isValidType=function(a){return this.types.indexOf(a)>=0},this.computeGraph=function(b,c){if(!this.isValidType(c))return console.log("Error: illegal stat type",c),[];for(var d=b.max_level,e=b[c+"_min"],f=b[c+"_max"],g=b[c+"_scale"],h=[],i=1;d+1>i;i++)h.push(a(i,e,f,d,g));return h}}]).directive("preventDefault",[function(){return function(a,b,c){angular.element(b).bind("click",function(a){a.preventDefault(),a.stopPropagation()})}}]).filter("byName",[function(){return function(a,b){return!a||!b||b.length<3?[]:a.filter(function(a){return a.name.toLowerCase().indexOf(b.toLowerCase())>-1})}}]);